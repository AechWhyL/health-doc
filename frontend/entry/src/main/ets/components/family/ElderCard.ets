import { ArchiveStats } from '../../models/HealthArchiveModels';
import { LengthMetrics } from '@kit.ArkUI';

@Component
export struct ElderCard {
  @Prop elderName: string = '';
  @Prop elderAge: number = 0;
  @Prop elderGender: number = 0; // 0=å¥³, 1=ç”·
  @Prop elderPhone: string = '';
  @Prop relationName: string = '';
  @Prop archiveStats: ArchiveStats = { total: 0, breakdown: {} };
  onCardClick: () => void = () => {};
  onViewArchive: () => void = () => {};

  private getGenderText(): string {
    return this.elderGender === 1 ? 'ç”·' : 'å¥³';
  }

  private getGenderIcon(): string {
    return this.elderGender === 1 ? 'ðŸ‘´' : 'ðŸ‘µ';
  }

  private formatPhone(): string {
    return this.elderPhone;
  }

  build() {
    Column() {
      // é¡¶éƒ¨ä¿¡æ¯åŒº
      Row() {
        // å¤´åƒåŒºåŸŸ
        Column() {
          Text(this.getGenderIcon())
            .fontSize(32)
        }
        .width(56)
        .height(56)
        .borderRadius(28)
        .backgroundColor('#f1f5f9')
        .justifyContent(FlexAlign.Center)
        .alignItems(HorizontalAlign.Center)

        // åŸºæœ¬ä¿¡æ¯
        Column() {
          Row() {
            Text(this.elderName)
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .fontColor('#1e293b')
            Text(' Â· ' + this.getGenderText() + ' Â· ' + this.elderAge + 'å²')
              .fontSize(14)
              .fontColor('#64748b')
          }

          Text('è”ç³»ç”µè¯ï¼š' + this.formatPhone())
            .fontSize(13)
            .fontColor('#94a3b8')
            .margin({ top: 4 })

          if (this.relationName && this.relationName !== '') {
            Text('å…³ç³»ï¼š' + this.relationName)
              .fontSize(12)
              .fontColor('#2563eb')
              .backgroundColor('#eff6ff')
              .padding({ left: 8, right: 8, top: 2, bottom: 2 })
              .borderRadius(10)
              .margin({ top: 6 })
          }
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)
        .margin({ left: 14 })
      }
      .width('100%')

      // åˆ†éš”çº¿
      Divider()
        .strokeWidth(1)
        .color('#e2e8f0')
        .margin({ top: 14, bottom: 14 })

      // æ¡£æ¡ˆç»Ÿè®¡åŒº
      Row() {
        Column() {
          Text(this.archiveStats.total.toString())
            .fontSize(20)
            .fontWeight(FontWeight.Bold)
            .fontColor('#1e293b')
          Text('æ¡£æ¡ˆæ€»æ•°')
            .fontSize(12)
            .fontColor('#64748b')
            .margin({ top: 4 })
        }
        .alignItems(HorizontalAlign.Center)
        .width(80)

        // åž‚ç›´åˆ†å‰²çº¿
        Divider()
          .vertical(true)
          .height(30)
          .color('#e2e8f0')
          .margin({ left: 5, right: 5 })

        Column(){

        }
        // æ‘˜è¦è¯¦æƒ…
        Flex({
          wrap:FlexWrap.Wrap,
          space:{
            main:LengthMetrics.vp(12),
            cross:LengthMetrics.vp(12)
          }
        }) {
          if (this.archiveStats.breakdown['MEDICAL_HISTORY']) {
            Text(`ç—…å² ${this.archiveStats.breakdown['MEDICAL_HISTORY']}`)
              .fontSize(12)
              .fontColor('#64748b')
              .backgroundColor('#f1f5f9')
              .padding({ left: 8, right: 8, top: 4, bottom: 4 })
              .borderRadius(4)
          }
           if (this.archiveStats.breakdown['CHECK_REPORT']) {
            Text(`æ£€æŸ¥ ${this.archiveStats.breakdown['CHECK_REPORT']}`)
              .fontSize(12)
              .fontColor('#64748b')
              .backgroundColor('#f1f5f9')
              .padding({ left: 8, right: 8, top: 4, bottom: 4 })
              .borderRadius(4)
          }
          if (this.archiveStats.breakdown['MEDICATION']) {
            Text(`ç”¨è¯ ${this.archiveStats.breakdown['MEDICATION']}`)
              .fontSize(12)
              .fontColor('#64748b')
              .backgroundColor('#f1f5f9')
              .padding({ left: 8, right: 8, top: 4, bottom: 4 })
              .borderRadius(4)
          }
          if (this.archiveStats.breakdown['ALLERGY']) {
            Text(`è¿‡æ• ${this.archiveStats.breakdown['ALLERGY']}`)
              .fontSize(12)
              .fontColor('#64748b')
              .backgroundColor('#f1f5f9')
              .padding({ left: 8, right: 8, top: 4, bottom: 4 })
              .borderRadius(4)
          }
        }
        .layoutWeight(1)
      }
      .width('100%')
      .alignItems(VerticalAlign.Center)

      // æ“ä½œæŒ‰é’®
      Row() {
        Blank()
        Text('æŸ¥çœ‹è¯¦æƒ… â†’')
          .fontSize(14)
          .fontColor('#2563eb')
          .fontWeight(FontWeight.Medium)
          .onClick(() => {
            this.onViewArchive();
          })
      }
      .width('100%')
      .margin({ top: 14 })
    }
    .width('100%')
    .padding(18)
    .backgroundColor(Color.White)
    .borderRadius(16)
    .shadow({
      radius: 8,
      color: '#0f172a14',
      offsetY: 2
    })
    .margin({ bottom: 14 })
    .onClick(() => {
      this.onCardClick();
    })
  }
}
