/**
 * ç»Ÿä¸€æ—¥æœŸé€‰æ‹©å™¨å¡ç‰‡ç»„ä»¶
 * ç‚¹å‡»å¼¹å‡ºæ—¥æœŸé€‰æ‹©å¯¹è¯æ¡†
 */
import dayjs from 'dayjs'

@Component
export struct FormDatePicker {
  @Prop label: string = ''
  @Prop optional: boolean = false
  @Link value: Date | null

  private formatDate(): string {
    if (!this.value) {
      return this.optional ? 'æœªè®¾ç½®' : 'è¯·é€‰æ‹©'
    }
    return dayjs(this.value).format('YYYY-MM-DD')
  }

  private showPicker(): void {
    DatePickerDialog.show({
      start: new Date('2000-01-01'),
      end: new Date('2100-12-31'),
      selected: this.value || new Date(),
      onAccept: (result: DatePickerResult) => {
        const d = new Date()
        d.setFullYear(result.year, result.month, result.day)
        d.setHours(0, 0, 0, 0)
        this.value = d
      }
    })
  }

  build() {
    Column() {
      // æ ‡ç­¾
      Row() {
        Text(this.label)
          .fontSize(14)
          .fontWeight(FontWeight.Medium)
          .fontColor('#374151')
        if (this.optional) {
          Text(' (å¯é€‰)')
            .fontSize(12)
            .fontColor('#9ca3af')
        }
      }
      .width('100%')
      .margin({ bottom: 8 })

      // æ—¥æœŸå¡ç‰‡
      Row() {
        Text(this.formatDate())
          .fontSize(15)
          .fontColor(this.value ? '#111827' : '#9ca3af')
          .layoutWeight(1)

        Row() {
          if (this.value && this.optional) {
            Text('æ¸…é™¤')
              .fontSize(13)
              .fontColor('#dc2626')
              .margin({ right: 12 })
              .onClick(() => {
                this.value = null
              })
          }
          Text('ðŸ“…')
            .fontSize(18)
        }
      }
      .width('100%')
      .height(48)
      .padding({ left: 14, right: 14 })
      .backgroundColor('#f8fafc')
      .borderRadius(12)
      .onClick(() => {
        this.showPicker()
      })
    }
    .width('100%')
    .margin({ bottom: 16 })
  }
}
